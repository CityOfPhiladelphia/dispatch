<% if policy(@opportunity).subscribe? %>
  <a class='button primary <% if current_user.opportunities.include?(@opportunity) %>disabled<% end %>' href='<%= subscribe_opportunity_path %>' data-method='post'>
    <% if current_user.opportunities.include?(@opportunity) %>
      <%= t('subscribed') %>
    <% else %>
      <%= t('subscribe') %>
    <% end %>
  </a>
<% elsif OpportunityPolicy.new(User.new, @opportunity).subscribe? %>
  <% # @todo redirect after login %>
  <a class='button primary' href='<%= new_user_session_path %>'><%= t('subscribe') %></a>
<% end %>
